function PJaxRouter(t){this.router={isLoading:!1,history:[{href:window.location.href,title:document.title}],ajaxCalls:0},this._mutations={countMutations:0,mutationObserver:null,isActive:!1},this._initParams(t),this._initEvents()}PJaxRouter.prototype._initParams=function(t){this.params={container:document.body,cancelNavigationClass:null,onStart:{value:function(){}},onReady:{value:function(){}},onLeaving:{duration:1e3,value:function(){}},onAfter:{duration:1e3,value:function(){}},onWaiting:{value:function(){}},onError:{value:function(){}}},Object.assign(this.params,t),this.params.container||(this.params.container=document.body)},PJaxRouter.prototype._initEvents=function(){var t=this;window.addEventListener("hashchange",function(){t.router.history.push({href:window.location.href,title:document.title})}),window.addEventListener("popstate",function(){var e,n,i,a;e=t.router.history[t.router.history.length-1].href,n=window.location.href;var o=!1;if(-1!=e.indexOf("#")){var r=e.indexOf("#");i=e.substring(0,r)}else i=e;if(-1!=n.indexOf("#")){r=n.indexOf("#");a=n.substring(0,r)}else a=n;i==a&&(o=!0),o||t._launchAjaxNavigation(window.location.href,!1)}),window.addEventListener("click",function(e){var n=e.target;if("A"!==n.name&&(n=n.closest("a")),n){var i=n.getAttribute("href");if(!(t.params.cancelNavigationClass&&n.classList.contains(t.params.cancelNavigationClass)||-1!==i.indexOf("mailto:"))){if(window.location.pathname===i||window.location.href===i)return e.preventDefault(),e.stopPropagation(),!1;e.preventDefault(),e.stopPropagation(),t._launchAjaxNavigation(i,!0)}}}),window.MutationObserver&&(this._mutations.isActive=!0,this._mutations.mutationObserver=new MutationObserver(function(e,n){(e[0].addedNodes.length||e[0].removedNodes.length)&&t._observedMutation(e)}))},PJaxRouter.prototype._launchAjaxNavigation=function(t,e){if(!this.router.isLoading){this._routing(t,e),this.params.onStart.value();var n=this;setTimeout(function(){n.params.onLeaving.value(),n.router.nextHTMLContent?n._appendDatas(e):n._waitForDatas(e)},n.params.onLeaving.duration)}},PJaxRouter.prototype._waitForDatas=function(t){var e=this,n=setInterval(function(){e.router.nextHTMLContent&&(clearInterval(n),e._appendDatas(t))},1e3)},PJaxRouter.prototype._observedMutation=function(t){for(var e=0;e<t.length;e++){t[e].addedNodes.length>0&&this._mutations.countMutations++}if(1===this._mutations.countMutations){this._mutations.mutationObserver.disconnect();var n=this;setTimeout(function(){n._newContentAdded()},34)}},PJaxRouter.prototype._newContentAdded=function(){var t=this;setTimeout(function(){t.params.onReady.value()},0),setTimeout(function(){t.router.isLoading=!1,t.params.onAfter.value()},t.params.onAfter.duration)},PJaxRouter.prototype._appendDatas=function(t){var e=this.router.nextHTMLContent.match(/<title[^>]*>([^<]+)<\/title>/)[1];t&&window.history.pushState(this.router,e,this.router.nextHref),document.title=e,this.router.history.push({href:this.router.nextHref,title:e});var n=document.createElement("div");n.insertAdjacentHTML("beforeend",this.router.nextHTMLContent);var i=n.querySelector("#"+this.params.container.getAttribute("id"));n=null;var a=this;if(i&&i.children&&i.children.length>0){this._mutations.isActive?(this._mutations.countMutations=0,this._mutations.mutationObserver.observe(this.params.container,{childList:!0})):setTimeout(function(){a._newContentAdded()},25*i.children.length),this.params.container.innerHTML="";for(var o=document.createDocumentFragment();i.hasChildNodes();)o.appendChild(i.firstChild);this.params.container.appendChild(o)}},PJaxRouter.prototype._routing=function(t,e){if(this.router.isLoading=!0,this.router.nextHref=null,t?this.router.nextHref=t:this.router.history.length>0&&(this.router.nextHref=this.router.history[this.router.history.length-1].href),this.router.nextHTMLContent=null,this.router.nextHref){var n=new XMLHttpRequest,i=this;n.onreadystatechange=function(){4!==n.readyState||200!==n.status&&0!==n.status?4===n.readyState&&404!==n.status&&i.router.ajaxCalls<4?(0===i.router.ajaxCall&&i.params.onWaiting.value(),i.router.ajaxCalls++,i._routing(t,e)):4===n.readyState&&(i.router.ajaxCalls=0,i.router.isLoading=!1,i.params.onError.value()):i.router.nextHTMLContent=n.response},n.open("GET",t,!0),n.setRequestHeader("Accept","text/html"),n.send(null)}};